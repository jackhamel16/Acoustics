using Test

include("../../src/quadrature.jl")
include("../../src/mesh.jl")

@testset "quadrature tests" begin
    @testset "gaussQuadrature tests" begin
        @testset "gaussQuadrature points and weights tests" begin
            gauss7points_reference = [3.33333333333333314829616256247391e-01 3.33333333333333314829616256247391e-01 3.33333333333333314829616256247391e-01
                                      4.70142064105100010440452251714305e-01 4.70142064105100010440452251714305e-01 5.97158717897999791190954965713900e-01
                                      4.70142064105100010440452251714305e-01 5.97158717897999791190954965713900e-02 4.70142064105100010440452251714305e-01
                                      5.97158717897999791190954965713900e-02 4.70142064105100010440452251714305e-01 4.70142064105100010440452251714305e-01
                                      1.01286507323455995943639607048681e-01 1.01286507323455995943639607048681e-01 7.97426985353087980357145170273725e-01
                                      1.01286507323455995943639607048681e-01 7.97426985353087980357145170273725e-01 1.01286507323455995943639607048681e-01
                                      7.97426985353087980357145170273725e-01 1.01286507323455995943639607048681e-01 1.01286507323455995943639607048681e-01]
            gauss7weights_reference = [2.25000000000000255351295663786004e-01
                                       1.32394152788506136442236993389088e-01
                                       1.32394152788506136442236993389088e-01
                                       1.32394152788506136442236993389088e-01
                                       1.25939180544827139529573400977824e-01
                                       1.25939180544827139529573400977824e-01
                                       1.25939180544827139529573400977824e-01]
           gauss13points_reference = [3.33333333333333314829616256247391e-01 3.33333333333333314829616256247391e-01 3.33333333333333314829616256247391e-01;
                                      2.60345966079039981000420311829657e-01 2.60345966079039981000420311829657e-01 4.79308067841920037999159376340685e-01;
                                      2.60345966079039981000420311829657e-01 4.79308067841920037999159376340685e-01 2.60345966079039981000420311829657e-01;
                                      4.79308067841920037999159376340685e-01 2.60345966079039981000420311829657e-01 2.60345966079039981000420311829657e-01;
                                      6.51301029022160055115264754022064e-02 6.51301029022160055115264754022064e-02 8.69739794195568016732522664824501e-01;
                                      6.51301029022160055115264754022064e-02 8.69739794195568016732522664824501e-01 6.51301029022160055115264754022064e-02;
                                      8.69739794195568016732522664824501e-01 6.51301029022160055115264754022064e-02 6.51301029022160055115264754022064e-02;
                                      4.86903154253160025399793653377856e-02 3.12865496004874010793628258397803e-01 6.38444188569810000544180184078868e-01;
                                      4.86903154253160025399793653377856e-02 6.38444188569810000544180184078868e-01 3.12865496004874010793628258397803e-01;
                                      3.12865496004874010793628258397803e-01 4.86903154253160025399793653377856e-02 6.38444188569810000544180184078868e-01;
                                      3.12865496004874010793628258397803e-01 6.38444188569810000544180184078868e-01 4.86903154253160025399793653377856e-02;
                                      6.38444188569810000544180184078868e-01 4.86903154253160025399793653377856e-02 3.12865496004874010793628258397803e-01;
                                      6.38444188569810000544180184078868e-01 3.12865496004874010793628258397803e-01 4.86903154253160025399793653377856e-02]
           gauss13weights_reference = [-1.49570044467682294886401450639823e-01
                                        1.75615257433208354909126569509681e-01
                                        1.75615257433208354909126569509681e-01
                                        1.75615257433208354909126569509681e-01
                                        5.33472356088381047256596900751902e-02
                                        5.33472356088381047256596900751902e-02
                                        5.33472356088381047256596900751902e-02
                                        7.71137608902571491942268266939209e-02
                                        7.71137608902571491942268266939209e-02
                                        7.71137608902571491942268266939209e-02
                                        7.71137608902571491942268266939209e-02
                                        7.71137608902571491942268266939209e-02
                                        7.71137608902571491942268266939209e-02]
            @test gauss7points == gauss7points_reference
            @test gauss7weights == gauss7weights_reference
            # @test gauss13points == gauss13points_reference
            # @test gauss13weights == gauss13weights_reference
        end
        @testset "gaussQuadrature function tests" begin
            returnZero(x,y,z) = 0
            points = [0.0 0.0 0.0]; weights = [1.0]
            @test gaussQuadrature(1.0, returnZero, points, weights) == 0

            returnXplusYplusZ(x,y,z) = x + y + z
            points = [-1.5 0.5 0.0; 0.0 1.0 2.0]; weights = [1.0, 9.1]
            solution = 26.299999999999997
            @test gaussQuadrature(1.0, returnXplusYplusZ, points, weights) == solution
        end
        @testset "integrateTriangle function tests" begin
            f(x,y,z) = 2*x
            nodes = [0.0 0.0 0.0; 2.0 0.0 0.0; 0.0 2.0 0.0]
            solution = 8/3
            @test isapprox(integrateTriangle(nodes, f, gauss7points, gauss7weights), solution, rtol=1e-16)
            @test isapprox(integrateTriangle(nodes, f, gauss13points, gauss13weights), solution, rtol=1e-15)
        end
    end


end
